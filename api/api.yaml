openapi: "3.0.0"
info:
  version: 1.0.0
  title: RAG Server API
paths:
  /files:
    post:
      summary: Upload a file and add documents extracted from it to the knowledge base
      operationId: uploadFile
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "200":
          description: A single file object.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/File"
    get:
      summary: List uploaded files
      operationId: listFiles
      responses:
        "200":
          description: Array of file objects
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Files"
  /files/{id}:
    get:
      summary: Get a single file by ID
      operationId: getFileById
      parameters:
        - name: id
          in: path
          description: File ID
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: A single file object.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/File"
  /files/{id}/documents:
    get:
      summary: List file documents
      operationId: listFileDocuments
      parameters:
        - name: id
          in: path
          description: File ID
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Array of document extracted from a file
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Documents"
  /query:
    post:
      summary: Query the RAG server.
      operationId: query
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Query"
      responses:
        "200":
          description: Responses to the query
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Response"
  /screenings:
    post:
      summary: Create a screening.
      operationId: createScreening
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScreeningParams"
      responses:
        "200":
          description: Screening object
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Screening"
    get:
      summary: List screenings
      operationId: listScreenings
      responses:
        "200":
          description: Array of screening objects
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Screenings"
  /screenings/{id}:
    get:
      summary: Get a single screening by ID
      operationId: getScreeningById
      parameters:
        - name: id
          in: path
          description: Screening ID
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: A single screening object.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Screening"

components:
  schemas:
    File:
      type: object
      required:
        - id
        - file_name
        - content_type
        - extension
        - size
        - hash
        - status
        - status_message
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        file_name:
          type: string
        content_type:
          type: string
        extension:
          type: string
        size:
          type: integer
          format: int64
        hash:
          type: string
        status:
          type: string
          enum: [UPLOADED, PROCESSING, PROCESSED_SUCCESSFULLY, PROCESSING_FAILED]
        status_message:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    Files: 
      type: object
      required:
        - files
      properties:
        files:
          type: array
          items:
            $ref: "#/components/schemas/File"
    Documents: 
      type: object
      required:
        - documents
      properties:
        documents:
          type: array
          items:
            $ref: "#/components/schemas/Document"
    Document:
      type: object
      required:
        - content
        - page
      properties:
        content:
          type: string
        page:
          type: integer
          format: int32
    Question:
      type: object
      required:
        - type
        - content
      properties:
        type:
          type: string
          enum: [TEXT, METRIC, BOOLEAN]
        content:
          type: string
    Query:
      type: object
      required:
        - file_ids
        - question
      properties:
        question:
          $ref: "#/components/schemas/Question"
        file_ids:
          type: array
          items:
            type: string
            format: uuid
    Response:
      type: object
      required:
        - question
        - answers
      properties:
        question:
          $ref: "#/components/schemas/Question"
        answers:
          type: array
          items:
            type: object
            $ref: "#/components/schemas/Answer"
    Answer:
      type: object
      required:
        - text
        - evidence
      properties:
        text:
          type: string
        metric:
          type: object
          $ref: "#/components/schemas/MetricValue"
        boolean: 
          type: boolean
        evidence:
          type: array
          items:
            type: object
            $ref: "#/components/schemas/Evidence"
    Evidence:
      type: object
      required:
        - file_id
        - page
        - text
      properties:
        file_id:
          type: string
          format: uuid
        page:
          type: integer
          format: int32
        text:
          type: string
    MetricValue:
      type: object
      required:
        - value
      properties:
        value:
          type: number
          format: double
        unit:
          type: string
    ScreeningParams:
      type: object
      required:
        - file_ids
        - questions
      properties:
        id:
          type: string
          format: uuid
        file_ids:
          type: array
          items:
            type: string
            format: uuid
        questions: 
          type: array
          items:
            $ref: "#/components/schemas/Question"
    Screening:
      type: object
      required:
        - id
        - files
        - questions
        - status
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        files: 
          type: array
          items:
            $ref: "#/components/schemas/File"
        questions: 
          type: array
          items:
            $ref: "#/components/schemas/Question"
        status:
          type: string
          enum: [REQUESTED, GENERATING, SUCCESSFUL, FAILED]
        status_message:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    Screenings: 
      type: object
      required:
        - screenings
      properties:
        screenings:
          type: array
          items:
            $ref: "#/components/schemas/Screening"
